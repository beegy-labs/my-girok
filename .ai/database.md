# Database Quick Reference

> goose (MIT, zero cost) + Prisma (TypeScript types) + ArgoCD | **Last Updated**: 2026-01-17

## Databases

| Service               | Dev DB               | Type       |
| --------------------- | -------------------- | ---------- |
| auth-service          | girok_auth_dev       | PostgreSQL |
| personal-service      | girok_personal_dev   | PostgreSQL |
| authorization-service | authorization_db_dev | PostgreSQL |
| audit-service         | audit_db_dev         | ClickHouse |
| analytics-service     | analytics_db_dev     | ClickHouse |

## Commands

```bash
# Create migration
goose -dir migrations create add_feature sql

# Run migrations (auto in ArgoCD PreSync)
goose -dir migrations postgres "$DATABASE_URL" up

# Sync Prisma after migration
pnpm prisma db pull && pnpm prisma generate
```

## SQL Format

```sql
-- +goose Up
CREATE TABLE features (
    id UUID PRIMARY KEY,  -- UUIDv7 generated by app (ID.generate())
    created_at TIMESTAMPTZ(6) DEFAULT NOW()
);

-- +goose Down
DROP TABLE IF EXISTS features;
```

## Rules

| Do                       | Don't             |
| ------------------------ | ----------------- |
| goose for ALL DBs        | `prisma migrate`  |
| UUID type (UUIDv7)       | TEXT for IDs      |
| App-generated UUIDv7     | DB DEFAULT for ID |
| TIMESTAMPTZ(6)           | TIMESTAMP         |
| Include `-- +goose Down` | Skip rollback     |

**ID Generation Policy**:

- Use `ID.generate()` from `@my-girok/nest-common` (generates UUIDv7)
- Database column type: `UUID` (native PostgreSQL UUID type)
- NO DEFAULT in database (application must provide ID)

**SSOT**:

- **Migration Strategy**: `docs/llm/policies/database-migration-strategy.md` (2026 decision: goose vs Atlas/Liquibase)
- Policy: `docs/llm/policies/database.md`
- Migration Guide: `docs/llm/guides/db-migration.md`
- **Troubleshooting**: `docs/llm/guides/migration-troubleshooting.md`
