# Scope: 2026-Scope1 (Mail & Notification Services)

> **WHEN**: Work range from roadmap | Human defines range, LLM documents

## Status

| Phase            | Status         | Date       |
| ---------------- | -------------- | ---------- |
| Scope Definition | âœ… Complete    | 2026-01-22 |
| Task Generation  | âœ… Complete    | 2026-01-22 |
| Human Approval   | âœ… Approved    | 2026-01-22 |
| Implementation   | ğŸ”„ In Progress | 2026-01-22 |

## Target

Build mail-service (personal email inbox) and notification-service (unified notification hub) as the foundation for all notifications and invitations across the platform.

**Service Separation:**

- **mail-service**: Personal email inbox (AWS SES delivery, email tracking, personal inbox)
- **notification-service**: Unified notification hub (In-app, Push, SMS, routes to mail-service for email)

**Solution-level Tracking (sourceService):**
Both services track which solution (app/web) sent the message:

- `my-girok`: Main B2C app/web service
- `auth`: Authentication/Admin portal

This enables analytics and filtering by solution origin.

## Period

2026-01 ~ 2026-02 (Scope 1 of Phase 1)

## Items from Roadmap

### mail-service (Personal Email)

| Priority | Feature                   | Description                     | Status |
| -------- | ------------------------- | ------------------------------- | ------ |
| P0       | Proto definition          | gRPC interface for mail-service | âœ…     |
| P0       | mail-service creation     | NestJS gRPC server              | âœ…     |
| P0       | i18n templates            | Multi-language email templates  | âœ…     |
| P0       | Database design           | EmailLog, Inbox tables          | âœ…     |
| P0       | Containerization          | Dockerfile, docker-compose      | âœ…     |
| P0       | Helm Chart                | K8s deployment                  | âœ…     |
| P0       | Kafka integration         | Email send queuing via Redpanda | â³     |
| P0       | AWS SES Integration       | Actual email delivery           | â³     |
| P0       | SES Webhook               | Open/Click/Bounce tracking      | â³     |
| P0       | audit-service integration | Auth email compliance tracking  | â³     |
| P0       | auth-bff integration      | gRPC Client                     | â³     |

### notification-service (Unified Notification Hub)

| Priority | Feature                      | Description                                        | Status |
| -------- | ---------------------------- | -------------------------------------------------- | ------ |
| P0       | Proto definition             | gRPC interface (moved to Phase 0)                  | â³     |
| P0       | notification-service setup   | NestJS gRPC server                                 | â³     |
| P0       | Database design              | Notification, Preferences, DeviceToken, QuietHours | â³     |
| P0       | In-app notifications         | Store/query in-app notifications                   | â³     |
| P0       | Push notification (FCM/APNS) | Firebase Cloud Messaging integration               | â³     |
| P0       | Device Token Management      | Register/unregister FCM/APNS tokens                | â³     |
| P0       | Containerization             | Dockerfile, docker-compose                         | â³     |
| P0       | Helm Chart                   | K8s deployment                                     | â³     |
| P0       | audit-service integration    | Auth notification compliance tracking              | â³     |
| P1       | SMS integration              | SMS gateway integration                            | â³     |
| P1       | User preferences             | Channel + Type preferences                         | â³     |
| P1       | Quiet Hours (DND)            | Do-not-disturb settings per user                   | â³     |
| P1       | Priority handling            | LOW/NORMAL/HIGH/URGENT (URGENT bypasses DND)       | â³     |
| P1       | Idempotency                  | Duplicate notification prevention                  | â³     |

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  auth-bff   â”‚ â”€â”€â”€â”€â”€ gRPC â”€â”€â”€> â”‚ notification-serviceâ”‚
â”‚  (+ others) â”‚                 â”‚ (Unified Hub)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  - In-app           â”‚
                                â”‚  - Push (FCM/APNS)  â”‚
                                â”‚  - SMS              â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ gRPC (email routing)
                                           â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      Kafka      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ mail-service â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ AWS SES â”‚
                                â”‚ (Email)      â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚  - i18n      â”‚
                                â”‚  - Templates â”‚
                                â”‚  - Tracking  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PostgreSQL                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ mail_db            â”‚    â”‚ notification_db                         â”‚   â”‚
â”‚  â”‚ - email_logs       â”‚    â”‚ - notifications                         â”‚   â”‚
â”‚  â”‚ - inboxes          â”‚    â”‚ - channel_preferences                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ - type_preferences                      â”‚   â”‚
â”‚                            â”‚ - device_tokens                         â”‚   â”‚
â”‚                            â”‚ - quiet_hours                           â”‚   â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Success Criteria

### mail-service

- [x] mail-service gRPC server working
- [x] i18n templates (ko, en) working
- [x] Database design (EmailLog, Inbox)
- [x] Helm deploy ready
- [ ] Kafka message publish/consume working
- [ ] AWS SES email delivery success
- [ ] SES Webhook tracking (open/click/bounce)
- [ ] auth-bff can call mail-service via gRPC
- [ ] 80% test coverage
- [ ] CDD documentation updated

### notification-service

- [ ] notification-service gRPC server working
- [ ] Database design (Notification, Preferences, DeviceToken, QuietHours)
- [ ] In-app notification store/query working
- [ ] Push notification (FCM) working
- [ ] Device token registration/unregistration working
- [ ] Quiet hours (DND) settings working
- [ ] Priority handling (URGENT bypasses DND)
- [ ] Idempotency (duplicate prevention) working
- [ ] Routes email to mail-service
- [ ] Helm deploy ready
- [ ] 80% test coverage
- [ ] CDD documentation updated

## Deliverables

### mail-service (âœ… Phase 1-2 Complete)

| Deliverable      | Path                                     | Status |
| ---------------- | ---------------------------------------- | ------ |
| mail-service     | `services/mail-service/`                 | âœ…     |
| Proto definition | `packages/proto/mail/v1/mail.proto`      | âœ…     |
| Helm Chart       | `services/mail-service/helm/`            | âœ…     |
| Dockerfile       | `services/mail-service/Dockerfile`       | âœ…     |
| docker-compose   | `docker-compose.yml.example`             | âœ…     |
| gRPC Client      | `packages/nest-common/` (MailGrpcClient) | â³     |
| CDD Indicator    | `.ai/services/mail-service.md`           | â³     |
| CDD SSOT         | `docs/llm/services/mail-service.md`      | â³     |

### notification-service (â³ Pending)

| Deliverable          | Path                                                | Status |
| -------------------- | --------------------------------------------------- | ------ |
| notification-service | `services/notification-service/`                    | â³     |
| Proto definition     | `packages/proto/notification/v1/notification.proto` | â³     |
| Helm Chart           | `services/notification-service/helm/`               | â³     |
| Dockerfile           | `services/notification-service/Dockerfile`          | â³     |
| gRPC Client          | `packages/nest-common/` (NotificationGrpcClient)    | â³     |
| CDD Indicator        | `.ai/services/notification-service.md`              | â³     |
| CDD SSOT             | `docs/llm/services/notification-service.md`         | â³     |

## References

- **Roadmap**: `roadmap.md`
- **Tasks**: `tasks/2026-scope1.md`
- **Architecture Diagrams**: `diagrams/2026-scope1-architecture.md`
- **Feature Spec**: `menu-structure.md` (Section 4.5 Identity â†’ Provisioning)
