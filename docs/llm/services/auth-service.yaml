# Auth Service Specification - Machine-Readable
# SSOT for: .ai/services/auth-service.md, docs/en/services/AUTH_SERVICE.md
version: "1.0"
last_updated: "2026-01-06"

service:
  name: "auth-service"
  description: "Authorization + RBAC - Roles, Permissions, Operators, Sanctions"
  status: "Active"

ports:
  rest: 3001
  grpc: 50052

database:
  name: "auth_db"
  engine: "PostgreSQL"
  tables: 12

entities:
  - name: "roles"
    description: "RBAC roles"
    fields:
      - "id"
      - "name"
      - "description"
      - "permissions"
  - name: "permissions"
    description: "Fine-grained permissions"
    fields:
      - "id"
      - "resource"
      - "action"
  - name: "operators"
    description: "Service operators"
    fields:
      - "id"
      - "accountId"
      - "serviceSlug"
      - "countryCode"
  - name: "sanctions"
    description: "User/operator sanctions"
    fields:
      - "id"
      - "targetId"
      - "type"
      - "reason"
      - "expiresAt"

grpc:
  package: "auth.v1"
  proto_path: "packages/proto/auth/v1/"
  services:
    - "RoleService"
    - "PermissionService"
    - "OperatorService"
    - "SanctionService"

token_types:
  - type: "USER_ACCESS"
    payload:
      - "services"
      - "countryCode"
      - "accountMode"
    ttl: "15min"
  - type: "ADMIN_ACCESS"
    payload:
      - "scope"
      - "permissions"
      - "level"
    ttl: "15min"
  - type: "OPERATOR_ACCESS"
    payload:
      - "serviceSlug"
      - "countryCode"
    ttl: "15min"

guards:
  - name: "UnifiedAuthGuard"
    description: "Routes by token type"
  - name: "ServiceAccessGuard"
    description: "Service-level access"
  - name: "CountryConsentGuard"
    description: "Country-specific consent"

events:
  publishes:
    - "ROLE_ASSIGNED"
    - "PERMISSION_GRANTED"
    - "OPERATOR_CREATED"
    - "SANCTION_APPLIED"
    - "SANCTION_LIFTED"
