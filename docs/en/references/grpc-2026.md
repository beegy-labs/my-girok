# gRPC Best Practices - 2026

This guide covers gRPC best practices as of 2026, focusing on Protocol Buffers, Node.js implementation, and microservices communication patterns.

## Overview

| Feature         | Value                                |
| --------------- | ------------------------------------ |
| Protocol        | HTTP/2 + Protocol Buffers            |
| Serialization   | Binary (10x smaller than JSON)       |
| Streaming       | Unary, Server, Client, Bidirectional |
| Code Generation | Multi-language from .proto files     |

## Project Structure

```
packages/proto/
├── buf.yaml
├── buf.gen.yaml
└── src/
    ├── user/
    │   └── v1/
    │       └── user.proto
    ├── auth/
    │   └── v1/
    │       └── auth.proto
    └── common/
        └── v1/
            └── types.proto
```

## Protocol Buffer Design

### Service Definition

```protobuf
syntax = "proto3";

package user.v1;

import "google/protobuf/timestamp.proto";

service UserService {
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc ListUsers(ListUsersRequest) returns (stream User);
  rpc BatchCreateUsers(stream CreateUserRequest) returns (BatchCreateUsersResponse);
  rpc SyncUsers(stream SyncRequest) returns (stream SyncResponse);
}

message User {
  string id = 1;
  string email = 2;
  string name = 3;
  UserStatus status = 4;
  google.protobuf.Timestamp created_at = 5;
}

enum UserStatus {
  USER_STATUS_UNSPECIFIED = 0;
  USER_STATUS_ACTIVE = 1;
  USER_STATUS_INACTIVE = 2;
  USER_STATUS_SUSPENDED = 3;
}
```

### Proto Best Practices

| Rule                      | Example              | Reason                |
| ------------------------- | -------------------- | --------------------- |
| Use packages              | `package user.v1;`   | Namespace isolation   |
| Version in path           | `user/v1/user.proto` | API evolution         |
| Enum zero value           | `UNSPECIFIED = 0`    | Default handling      |
| Reserved fields           | `reserved 5, 6;`     | Safe field removal    |
| Never reuse field numbers | -                    | Wire format stability |

## Node.js Implementation

### Server Setup

```typescript
import { Server, ServerCredentials } from '@grpc/grpc-js';
import { UserServiceService } from './generated/user/v1/user_grpc_pb';

const server = new Server({
  'grpc.max_receive_message_length': 4 * 1024 * 1024,
  'grpc.max_send_message_length': 4 * 1024 * 1024,
  'grpc.keepalive_time_ms': 10000,
  'grpc.keepalive_timeout_ms': 5000,
});

server.addService(UserServiceService, userServiceImpl);

server.bindAsync('0.0.0.0:50051', ServerCredentials.createInsecure(), (err, port) => {
  if (err) throw err;
  console.log(`gRPC server running on port ${port}`);
});
```

### Client Setup

```typescript
import { credentials, Metadata } from '@grpc/grpc-js';
import { UserServiceClient } from './generated/user/v1/user_grpc_pb';

const client = new UserServiceClient('localhost:50051', credentials.createInsecure(), {
  'grpc.keepalive_time_ms': 10000,
  'grpc.keepalive_timeout_ms': 5000,
  'grpc.max_reconnect_backoff_ms': 10000,
});

async function getUser(userId: string): Promise<User> {
  return new Promise((resolve, reject) => {
    const request = new GetUserRequest();
    request.setId(userId);

    const metadata = new Metadata();
    metadata.set('authorization', `Bearer ${token}`);

    const deadline = new Date();
    deadline.setSeconds(deadline.getSeconds() + 5);

    client.getUser(request, metadata, { deadline }, (err, response) => {
      if (err) return reject(err);
      resolve(response.getUser());
    });
  });
}
```

## Error Handling

### gRPC Status Codes

| Code | Name              | Use Case               |
| ---- | ----------------- | ---------------------- |
| 0    | OK                | Success                |
| 3    | INVALID_ARGUMENT  | Bad request data       |
| 5    | NOT_FOUND         | Resource doesn't exist |
| 7    | PERMISSION_DENIED | Auth failure           |
| 13   | INTERNAL          | Server error           |
| 14   | UNAVAILABLE       | Service unavailable    |

### Error Response

```typescript
import { status } from '@grpc/grpc-js';

callback({
  code: status.NOT_FOUND,
  message: 'User not found',
  details: JSON.stringify({ userId, timestamp: Date.now() }),
});
```

## Performance Guidelines

| Setting      | Recommendation        | Reason             |
| ------------ | --------------------- | ------------------ |
| Deadlines    | Always set            | Prevent hung calls |
| Keep-alive   | 10-30s                | Connection health  |
| Message size | Limit to 4MB          | Memory protection  |
| Backpressure | Handle in streaming   | Flow control       |
| Interceptors | Use for cross-cutting | DRY principle      |

## Load Balancing

### Client-Side (Recommended)

```typescript
const client = new UserServiceClient('dns:///user-service:50051', credentials.createInsecure(), {
  'grpc.service_config': JSON.stringify({
    loadBalancingConfig: [{ round_robin: {} }],
  }),
});
```

## Anti-Patterns to Avoid

| Don't               | Do                      | Reason             |
| ------------------- | ----------------------- | ------------------ |
| No deadlines        | Always set timeouts     | Prevent hangs      |
| Large payloads      | Stream or paginate      | Memory/latency     |
| Reuse field numbers | Reserve deleted fields  | Wire compatibility |
| Skip versioning     | Version in package path | API evolution      |
| Sync-only calls     | Use async/await         | Performance        |

## Sources

- [gRPC Node.js Tutorial](https://daily.dev/blog/build-a-grpc-service-in-nodejs)
- [gRPC Node.js TypeScript Guide](https://oneuptime.com/blog/post/2026-01-08-grpc-nodejs-typescript/view)
- [Advanced gRPC in Microservices](https://dzone.com/articles/advanced-grpc-in-microservices)
- [gRPC Official Node Basics](https://grpc.io/docs/languages/node/basics/)

---

_Last Updated: 2026-01-22_
