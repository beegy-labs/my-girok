{{- if .Values.externalSecrets.enabled }}
# Auth BFF Secrets ExternalSecret
# Contains: session-secret, encryption-key, OAuth credentials
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "auth-bff.fullname" . }}-secret
  labels:
    {{- include "auth-bff.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval | default "1h" }}
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: {{ include "auth-bff.fullname" . }}-secret
    creationPolicy: Owner
  data:
    # Session secret (required)
    - secretKey: session-secret
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/session
        property: session_secret
    # Encryption key (required)
    - secretKey: encryption-key
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/encryption
        property: encryption_key
    # Valkey password (optional)
    - secretKey: valkey-password
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/valkey
        property: password
    # Google OAuth
    - secretKey: google-client-id
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/google
        property: client_id
    - secretKey: google-client-secret
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/google
        property: client_secret
    # Kakao OAuth
    - secretKey: kakao-client-id
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/kakao
        property: client_id
    - secretKey: kakao-client-secret
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/kakao
        property: client_secret
    # Naver OAuth
    - secretKey: naver-client-id
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/naver
        property: client_id
    - secretKey: naver-client-secret
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/naver
        property: client_secret
    # Apple OAuth
    - secretKey: apple-client-id
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/apple
        property: client_id
    - secretKey: apple-team-id
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/apple
        property: team_id
    - secretKey: apple-key-id
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/apple
        property: key_id
    - secretKey: apple-private-key
      remoteRef:
        key: {{ include "auth-bff.vaultPathPrefix" . }}/auth-bff/oauth/apple
        property: private_key
{{- end }}
