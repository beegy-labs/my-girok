// Personal Service Database Schema
// Korean Developer Resume + Budget + Share

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========== Resume Models ==========

model Resume {
  id     String @id @default(uuid())
  userId String @unique // One resume per user

  // Basic Info
  name     String
  email    String
  phone    String?
  github   String?
  blog     String?
  linkedin String?
  portfolio String?

  // Summary
  summary String?

  // Profile Image
  profileImage String?

  // Sections (ordered and toggleable)
  sections ResumeSection[]

  // Skills
  skills Skill[]

  // Experiences
  experiences Experience[]

  // Projects
  projects Project[]

  // Education
  educations Education[]

  // Certificates
  certificates Certificate[]

  // Share Links
  shares ShareLink[] @relation("ResumeShares")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

// Section visibility and ordering
model ResumeSection {
  id       String  @id @default(uuid())
  resumeId String
  resume   Resume  @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  type    SectionType // SKILLS, EXPERIENCE, PROJECT, EDUCATION, CERTIFICATE
  order   Int         @default(0) // Display order
  visible Boolean     @default(true) // Show/hide toggle

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([resumeId, type])
  @@index([resumeId, order])
}

enum SectionType {
  SKILLS
  EXPERIENCE
  PROJECT
  EDUCATION
  CERTIFICATE
}

// Skills (Frontend, Backend, DevOps, etc.)
model Skill {
  id       String @id @default(uuid())
  resumeId String
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  category String // Frontend, Backend, DevOps, Database, Tools, etc.
  items    String[] // ["React", "TypeScript", "Next.js"]
  order    Int    @default(0)
  visible  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resumeId, order])
}

// Work Experience
model Experience {
  id       String @id @default(uuid())
  resumeId String
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  company     String
  position    String
  startDate   String // "2023-01" format
  endDate     String? // null = current
  description String // Job description

  achievements String[] // Key achievements
  techStack    String[] // Technologies used

  order   Int     @default(0)
  visible Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resumeId, order])
}

// Projects
model Project {
  id       String @id @default(uuid())
  resumeId String
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  name        String
  startDate   String // "2023-01" format
  endDate     String? // null = ongoing
  description String

  role         String? // Your role in project
  achievements String[] // Key achievements
  techStack    String[] // Technologies used

  url         String? // Project URL
  githubUrl   String? // GitHub repository

  order   Int     @default(0)
  visible Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resumeId, order])
}

// Education
model Education {
  id       String @id @default(uuid())
  resumeId String
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  school     String
  major      String
  degree     String // Bachelor, Master, PhD
  startDate  String // "2015-03" format
  endDate    String? // null = ongoing
  gpa        String?

  order   Int     @default(0)
  visible Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resumeId, order])
}

// Certificates and Awards
model Certificate {
  id       String @id @default(uuid())
  resumeId String
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  name        String
  issuer      String // Issuing organization
  issueDate   String // "2023-01" format
  expiryDate  String? // null = no expiry
  credentialId String?
  credentialUrl String?

  order   Int     @default(0)
  visible Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([resumeId, order])
}

// ========== Share Link Models ==========

model ShareLink {
  id    String @id @default(uuid())
  token String @unique @default(cuid())

  // Resource
  resourceType ResourceType
  resourceId   String
  userId       String

  // Share settings
  expiresAt DateTime?
  isActive  Boolean  @default(true)

  // Analytics
  viewCount    Int       @default(0)
  lastViewedAt DateTime?

  // Relations
  resume Resume? @relation("ResumeShares", fields: [resourceId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([token])
  @@index([userId])
  @@index([resourceType, resourceId])
  @@index([expiresAt])
}

enum ResourceType {
  RESUME
  BUDGET_SUMMARY
}

// ========== Budget Models (Future) ==========

model Transaction {
  id     String          @id @default(uuid())
  userId String
  type   TransactionType

  amount      Decimal @db.Decimal(12, 2)
  category    String
  description String?
  date        DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, date(sort: Desc)])
  @@index([userId, category])
}

enum TransactionType {
  INCOME
  EXPENSE
}

model Budget {
  id       String @id @default(uuid())
  userId   String
  category String
  amount   Decimal @db.Decimal(12, 2)
  period   Period  @default(MONTHLY)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, category, period])
  @@index([userId])
}

enum Period {
  MONTHLY
  YEARLY
}
